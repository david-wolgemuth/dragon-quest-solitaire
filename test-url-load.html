<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>URL State Test</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .success { color: green; }
    .error { color: red; }
    pre { background: #f0f0f0; padding: 10px; }
  </style>
</head>
<body>
  <h1>URL State Loading Test</h1>
  <div id="output"></div>

  <script src="cards.js"></script>
  <script src="url-state.js"></script>
  <script>
    const output = document.getElementById('output');

    function log(message, isError = false) {
      const div = document.createElement('div');
      div.className = isError ? 'error' : 'success';
      div.textContent = isError ? '❌ ' + message : '✅ ' + message;
      output.appendChild(div);
    }

    function logSection(title) {
      const h2 = document.createElement('h2');
      h2.textContent = title;
      output.appendChild(h2);
    }

    // Test URL state
    const testUrl = "health=AH2H3H4H5H:0&inventory=KHJHQDJDXRQHKD:7&gems=AD2D3D4D5D6D7D8D9D0D:10&fate=9H6H8H7H0H:5&dungeonStock=QC9SAC5C8C4C4S6SQSKC6C7C8S0S3CXBJS3S5S2S2CJCKS9C7S0C&dungeonMatrix=0,0,AS,1";

    logSection('Step 1: Testing deserializeGameState()');

    try {
      const state = deserializeGameState(testUrl);
      log('deserializeGameState() succeeded');

      // Check state structure
      if (state.health) log('health pile exists');
      else log('health pile missing', true);

      if (state.inventory) log('inventory pile exists');
      else log('inventory pile missing', true);

      if (state.gems) log('gems pile exists');
      else log('gems pile missing', true);

      if (state.fate) log('fate pile exists');
      else log('fate pile missing', true);

      if (state.dungeonStock) log('dungeonStock exists');
      else log('dungeonStock missing', true);

      if (state.dungeonMatrix) log('dungeonMatrix exists');
      else log('dungeonMatrix missing', true);

      logSection('Step 2: Checking Card objects');

      // Check if cards are proper Card instances
      if (state.health.available.length > 0) {
        const card = state.health.available[0];
        log('First health card: ' + card.suitKey + ' ' + card.valueKey);

        // Check if card has suit/value getters
        try {
          const suit = card.suit;
          const value = card.value;
          log('Card has suit getter: ' + JSON.stringify(suit));
          log('Card has value getter: ' + JSON.stringify(value));
        } catch (e) {
          log('Card getters failed: ' + e.message, true);
        }
      }

      logSection('Step 3: Displaying full state');
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify({
        health: {
          stock: state.health.stock.length,
          available: state.health.available.length
        },
        inventory: {
          stock: state.inventory.stock.length,
          available: state.inventory.available.length
        },
        gems: {
          stock: state.gems.stock.length,
          available: state.gems.available.length
        },
        fate: {
          stock: state.fate.stock.length,
          available: state.fate.available.length
        },
        dungeonStock: state.dungeonStock.length,
        dungeonMatrix: state.dungeonMatrix.length
      }, null, 2);
      output.appendChild(pre);

    } catch (error) {
      log('ERROR: ' + error.message, true);
      const pre = document.createElement('pre');
      pre.textContent = error.stack;
      output.appendChild(pre);
    }
  </script>
</body>
</html>
